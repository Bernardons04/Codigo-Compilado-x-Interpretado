<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Compara√ß√£o Compilador x Interpretador</title>

    <!-- Bootstrap 5.3 -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- SweetAlert2 -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <!-- Vue 2 -->
    <script src="https://cdn.jsdelivr.net/npm/vue@2/dist/vue.js"></script>
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <!-- Chart.js Data Labels -->
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2"></script>

    <style>
        body {
            background: linear-gradient(135deg, #0d6efd22, #20c99722);
            min-height: 100vh;
            font-family: 'Segoe UI', sans-serif;
            padding: 2rem;
        }

        .container-box {
            display: flex;
            gap: 2rem;
            justify-content: center;
            flex-wrap: wrap;
        }

        .lang-card {
            flex: 1 1 420px;
            background: #fff;
            border-radius: 1rem;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.1);
            padding: 2rem;
        }

        .output-box {
            background-color: #000;
            color: #0f0;
            font-family: "Fira Code", monospace;
            border-radius: 8px;
            padding: 15px;
            height: 200px;
            overflow-y: auto;
            white-space: pre-wrap;
            font-size: 0.9rem;
            margin-top: 1rem;
        }

        .comparison-card {
            background: #fff;
            padding: 1rem 1.5rem;
            border-radius: 0.8rem;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
            width: fit-content;
        }

        .faster {
            font-weight: bold;
            font-size: 1rem;
            color: #198754;
        }

        canvas {
            background: #fff;
            border-radius: 1rem;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
            padding: 1rem;
            margin-top: 2rem;
        }
    </style>
</head>

<body>
    <div id="app">
        <div class="text-center mb-4">
            <h2 class="fw-bold">üíª Compara√ß√£o: C (Compilado) x Python (Interpretado)</h2>
            <p class="text-secondary">Veja na pr√°tica a diferen√ßa de desempenho entre as linguagens</p>
        </div>

        <div class="container-box">

            <!-- C -->
            <div class="lang-card">
                <h4 class="text-primary fw-bold mb-3">C√≥digo em C</h4>
                <label class="form-label">Digite o termo N da sequ√™ncia de Fibonacci:</label>
                <input type="number" class="form-control mb-3" v-model.number="nC" placeholder="Ex: 35">
                <div class="output-box">{{ outputC }}</div>
            </div>

            <!-- Python -->
            <div class="lang-card">
                <h4 class="text-warning fw-bold mb-3">C√≥digo em Python</h4>
                <label class="form-label">Digite o termo N da sequ√™ncia de Fibonacci:</label>
                <input type="number" class="form-control mb-3" v-model.number="nPython" placeholder="Ex: 35">
                <div class="output-box">{{ outputPython }}</div>
            </div>
        </div>

        <div class="text-center mt-4">
            <button class="btn btn-dark btn-lg px-4" :disabled="!nC || !nPython || loadingGeral"
                @click="executarComparacao">

                <span v-if="loadingGeral" class="spinner-border spinner-border-sm me-2"></span>
                {{ loadingGeral ? 'Executando...' : 'Executar Compara√ß√£o' }}
            </button>
        </div>

        <!-- Resultado Atual -->
        <div class="comparison-container mt-4" v-if="comparacaoAtual">
            <div class="comparison-card">
                <h5>Resultado Atual</h5>
                <div v-html="comparacaoAtual.msg"></div>
                <small class="text-muted">C: {{ comparacaoAtual.cTime.toFixed(6) }}s | Python:
                    {{ comparacaoAtual.pyTime.toFixed(6) }}s</small>
            </div>
        </div>

        <hr class="my-5">

        <div class="mb-3 d-flex align-items-center justify-content-start gap-3">
            <h3 class="mb-0">Hist√≥rico de Compara√ß√µes</h3>
            <button class="btn btn-outline-primary btn-sm ms-2" @click="gerarGrafico"
                :disabled="historico.length === 0">
                <i class="bi bi-graph-up"></i> Gerar Gr√°fico
            </button>
        </div>

        <!-- Cards -->
        <div class="d-flex flex-wrap gap-2 mt-2">
            <div v-for="(h, i) in historico" :key="i" class="comparison-card">
                <strong>{{ h.timestamp }}</strong>
                <div v-html="h.msg"></div>
                <small class="text-muted">C: {{ h.cTime.toFixed(6) }}s | Python: {{ h.pyTime.toFixed(6) }}s</small>
            </div>
        </div>

        <!-- Gr√°fico -->
        <canvas id="grafico" v-if="historico.length > 0"></canvas>

    </div>

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">

    <script>
        const Toast = Swal.mixin({
            toast: true,
            position: 'top-end',
            showConfirmButton: false,
            timer: 2000,
            timerProgressBar: true
        });

        new Vue({
            el: '#app',
            data: {
                nC: null,
                nPython: null,
                loadingGeral: false,
                outputC: "",
                outputPython: "",
                cTime: null,
                pyTime: null,
                comparacaoAtual: null,
                historico: [],
                chart: null
            },
            methods: {
                async executarComparacao() {
                    this.loadingGeral = true;
                    this.outputC = "";
                    this.outputPython = "";

                    await this.runC();
                    await this.runPython();

                    this.atualizarComparacao();
                    this.loadingGeral = false;

                    Toast.fire({ icon: "success", title: "Compara√ß√£o realizada!" });
                },

                async runC() {
                    const res = await fetch("/run-c", {
                        method: "POST",
                        headers: { "Content-Type": "application/json" },
                        body: JSON.stringify({ n: this.nC })
                    });
                    const text = await res.text();
                    this.outputC = text;

                    const match = text.match(/Tempo de execucao: ([0-9.]+)/);
                    this.cTime = match ? parseFloat(match[1]) : null;
                },

                async runPython() {
                    const res = await fetch("/run-python", {
                        method: "POST",
                        headers: { "Content-Type": "application/json" },
                        body: JSON.stringify({ n: this.nPython })
                    });
                    const text = await res.text();
                    this.outputPython = text;

                    const match = text.match(/Tempo de execucao: ([0-9.]+)/);
                    this.pyTime = match ? parseFloat(match[1]) : null;
                },

                atualizarComparacao() {
                    let msg = "";
                    if (this.cTime < this.pyTime) {
                        msg = `<span class='faster'>üèéÔ∏è C foi ${(this.pyTime / this.cTime).toFixed(1)}x mais r√°pido que Python!</span>`;
                    } else {
                        msg = `<span class='faster text-warning'>üêç Python foi ${(this.cTime / this.pyTime).toFixed(1)}x mais r√°pido que C!</span>`;
                    }

                    const now = new Date();
                    const timestamp = now.toLocaleString("pt-BR");

                    this.comparacaoAtual = {
                        msg,
                        cTime: this.cTime,
                        pyTime: this.pyTime,
                        timestamp,
                        n: this.nC
                    };

                    this.historico.unshift(this.comparacaoAtual);
                },

                gerarGrafico() {
                    const ctx = document.getElementById("grafico").getContext("2d");

                    if (this.chart) this.chart.destroy();

                    const labels = this.historico.map(h => h.n).reverse();
                    const temposC = this.historico.map(h => h.cTime).reverse();
                    const temposPy = this.historico.map(h => h.pyTime).reverse();

                    this.chart = new Chart(ctx, {
                        type: "line",
                        plugins: [ChartDataLabels],
                        data: {
                            labels,
                            datasets: [
                                {
                                    label: "C (Compilado)",
                                    data: temposC,
                                    borderColor: "blue",
                                    borderWidth: 2,
                                    tension: 0.2,
                                    datalabels: {
                                        anchor: 'end',
                                        align: 'top',
                                        formatter: (v) => v.toFixed(4) + "s",
                                        font: { weight: 'bold', size: 10 }
                                    }
                                },
                                {
                                    label: "Python (Interpretado)",
                                    data: temposPy,
                                    borderColor: "orange",
                                    borderWidth: 2,
                                    tension: 0.2,
                                    datalabels: {
                                        anchor: 'end',
                                        align: 'top',
                                        formatter: (v) => v.toFixed(4) + "s",
                                        font: { weight: 'bold', size: 10 }
                                    }
                                }
                            ]
                        },
                        options: {
                            plugins: {
                                legend: { position: "bottom" },
                                title: { display: true, text: "Comparativo de Tempo de Execu√ß√£o" }
                            },
                            scales: {
                                y: {
                                    title: { display: true, text: "Tempo (s)" },
                                    ticks: { stepSize: 1 } // ALTERA√á√ÉO AQUI
                                },
                                x: {
                                    title: { display: true, text: "Valor de N" }
                                }
                            }
                        }
                    });

                    Toast.fire({ icon: "success", title: "Gr√°fico gerado!" });
                }
            }
        })
    </script>
</body>

</html>